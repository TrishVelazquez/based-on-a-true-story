{% extends 'base.html' %}


{% block title %} {{ movie.title }} {% endblock %}

<!-- Display for movie -->

{% block content %}

    <div class="container">

        <h2>{{ movie.title }}</h2>
        <img src={{ movie.poster }}>
        <br>Release Year: {{ movie.year }}
        <br>Plot: {{ movie.plot }}

            {% if movie.website_url != "N/A" %}
                <h5><a href="{{ movie.website_url }}">Visit {{ movie.title }}'s website.</a></h5>
            {% endif %}

    </div>

    <!-- If statement to check if movie Truths exist -->
    <!-- If exist, display the submitted Truths -->

    {% if movie_truths %}

        <br><h3>See The Discussion: </h3>

        {% for truth in movie_truths %}

            <div class="container">

                <h4>{{ truth.truth_title }}</h4>
                Submitted By: <a href="/user/{{ truth.user_id}}">{{ truth.username }}</a>

                <br>{{ truth.truth_submission }}

                {% if truth.resource_submission %}

                    <h5>Resource: <a href="{{ truth.resource_submission }}">External URL</a></h5>

                {% endif %}

                <h5>{{ truth.date_submitted }}</h5>

            </div>

            <!-- Reply field. Movie_id and _truth_id passed in sub rosa -->
            <!-- Reply field will appear for every Truth -->

            {% if "active_user" in session %}


            <form action="/add-reply" method="POST">
                <fieldset>

                    <br>
                    <input type="text" name="comment" required>
                    <input class="hidden" type="hidden" name="movie_id" value={{ movie.movie_id }} required>
                    <input class="hidden" type="hidden" name="truth_id" value={{ truth.truth_id }} required>
                    <input type="submit" value="Reply">

                </fieldset>
            </form>


            {% endif %}

        {% for reply in replies %}

            {% if truth.truth_id == reply.truth_id %}

            <!-- For each reply where the truth_id matches, display the replies -->

                <div class="container">

                    <h4>Re: {{ truth.truth_title }}</h4>
                    Submitted By: <a href="/user/{{ reply.user_id}}">{{ reply.username }}</a>
                    <br>{{ reply.comment }}
                    <h5>{{ reply.date_submitted }}</h5>

                </div>

                <!-- Also display reply field for each other reply -->
                {% if "active_user" in session %}


                <form action="/add-reply" method="POST">
                    <fieldset>

                        <br>
                        <input type="text" name="comment" required>
                        <input class="hidden" type="hidden" name="movie_id" value={{ movie.movie_id }} required>
                        <input class="hidden" type="hidden" name="truth_id" value={{ truth.truth_id }} required>
                        <input type="submit" value="Reply">

                    </fieldset>
                </form>



                {% endif %}

            {% endif %}

        {% endfor %}

        {% endfor %}

    {% else %}

        Boo! There are no Truths here yet.

    {% endif %}

    <!-- If statement to check for active user -->

    {% if "active_user" in session %}

        <div class="container">

            <form action="/movies/{{ movie.movie_id }}" method="POST">
                <fieldset>

                    <label><h4>Add your Truth</label></h4>
                    <br>
                    Title your Truth: <input type="text" name="title" required>
                    <br>
                    What's your Truth? <input type="text" name="truth" required>
                    <br>
                    Got any proof? <input type="url" name="resource">
                    <input type="submit" value="Add my truth!">
                    <br>
                    <br>

                </fieldset>
            </form>

        </div>

    {% else %}

        Want to be part of the discussion? 
        <h4><a id="movie-search-login" href="/login">Please log in to submit a Truth. </a>

    {% endif %}


{% endblock %}


